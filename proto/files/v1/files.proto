syntax = "proto3";

package files.v1;

service FileService {
    rpc CreatePresignedUpload(CreatePresignedUploadRequest) returns (CreatePresignedUploadResponse);

    rpc CreatePresignedUploadBatch(CreatePresignedUploadBatchRequest) returns (CreatePresignedUploadBatchResponse);

    rpc GetDownloadUrl(GetDownloadUrlRequest) returns (GetDownloadUrlResponse);

    rpc GetBatchDownloadUrls(GetBatchDownloadUrlsRequest) returns (GetBatchDownloadUrlsResponse);
}

enum FileVisibility {
    FILE_VISIBILITY_UNSPECIFIED = 0;
    FILE_VISIBILITY_PUBLIC = 1;
    FILE_VISIBILITY_PRIVATE = 2;
}

enum FileKind {
    FILE_KIND_UNSPECIFIED = 0;
    FILE_KIND_IMAGE = 1;
    FILE_KIND_PDF = 2;
    FILE_KIND_DOCUMENT = 3;
    FILE_KIND_OTHER = 4;
}

message CreatePresignedUploadRequest {
    string file_name = 1;
    string mime_type = 2;
    FileVisibility visibility = 4;
    optional string folder = 5;
    optional FileKind kind = 6;
}

message CreatePresignedUploadResponse {
    int64 file_id = 1;
    string bucket = 2;
    string key = 3;
    string upload_url = 4;
    int32 expires_in = 5;
    string http_method = 6;
    map<string, string> headers = 7;
}

message CreatePresignedUploadBatchRequest {
    string file_name = 1;
    string mime_type = 2;
    FileVisibility visibility = 4;
    optional string folder = 5;
    optional FileKind kind = 6;
    int32 amount_of_files = 7;
}

message CreatePresignedUploadBatchResponse {
  repeated CreatePresignedUploadResponse presigned_uploads = 1;
}


message GetDownloadUrlRequest {
    int64 file_id = 1;
    optional int32 expires_in = 2;
}

message GetDownloadUrlResponse {
    int64 file_id = 1;
    string download_url = 2;
    int32 expires_in = 3;
}

message GetBatchDownloadUrlsRequest {
    repeated int64 file_ids = 1;
    optional int32 expires_in = 2;
}

message GetBatchDownloadUrlsResponse {
    repeated GetDownloadUrlResponse download_urls = 1;
}
